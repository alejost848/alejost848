
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-input-error.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="../paper-input/paper-input-char-counter.html">
<link rel="import" href="../paper-input/paper-input-behavior.html">
<link rel="import" href="../paper-input/paper-textarea.html">

<link rel="import" href="../project-info/project-info.html">

<dom-module id="contact-page">
  <style>
  
    /*Default typography styles*/
    .paper-font-display4 {@apply(--paper-font-display4);}
    .paper-font-display3 {@apply(--paper-font-display3);}
    .paper-font-display2 {@apply(--paper-font-display2);}
    .paper-font-display1 {@apply(--paper-font-display1);}
    .paper-font-headline {@apply(--paper-font-headline);}
    .paper-font-title {@apply(--paper-font-title);}
    .paper-font-subhead {@apply(--paper-font-subhead);}
    .paper-font-body2 {@apply(--paper-font-body1);}
    .paper-font-body1 {@apply(--paper-font-body1);}
    .paper-font-caption {@apply(--paper-font-caption);}
    .paper-font-menu {@apply(--paper-font-menu);}
    .paper-font-button {@apply(--paper-font-button);}

    #home_wrapper{
      margin-top: 20px;
    }

    .input_width{
      width: 300px;
      --paper-input-container-focus-color: var(--accent-color);
    }

    #formPost{
      width: 300px;
    }

    #submit_form{
      margin-top: 20px;
    }

    #submit_button{
      margin: 0;
      margin-top: 40px;
      width: 300px;
      background-color: #ccc;
      height: 40px;
      padding: 0;
    }

    #submit_label{
      display: inline;
    }

    #spinner{
      display: none;
      --paper-spinner-layer-1-color: #aaa;
      --paper-spinner-layer-2-color: #aaa;
      --paper-spinner-layer-3-color: #aaa;
      --paper-spinner-layer-4-color: #aaa;
    }

    @media (max-width: 850px) {
     
    }

  </style>

  <template>
    <div id="submit_form" class="layout vertical center">
      <form is="iron-form" id="formPost" method="post" action="/">
        <paper-input id="name" required class="input_width" label="Name" error-message="Enter your name."></paper-input>
        <paper-input id="email" type="email" required class="input_width" label="Email" error-message="Enter a valid email."></paper-input>
        <paper-input id="subject" required class="input_width" label="Subject" error-message="Enter a subject."></paper-input>
        <paper-textarea id="message" required class="input_width" label="Message" error-message="Enter a message."></paper-textarea>
        <paper-button id="submit_button" onclick="clickHandler(event)" class="layout horizontal center-center">
            <div id="submit_label">Submit</div>
            <paper-spinner id="spinner" alt="Sending email" active></paper-spinner>
   
        </paper-button>
      </form>
    </div>
    
    <paper-toast id="msgSent" duration="3000" text="Message sent."></paper-toast>
    <paper-toast id="msgNotSent" duration="5000" text="Can't send your message. Try again."></paper-toast>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'contact-page',

    properties: {
      title: {
        type: String
      },
      subtitle: {
        type: String
      },
      image: {
        type: String
      }
    }
  });
</script>

<script>
  function clickHandler(event) {

  document.getElementById('email').validate();
  document.getElementById('name').validate(); 
  document.getElementById('subject').validate();
  document.getElementById('message').validate();

  if (document.getElementById('email').validate() && document.getElementById('name').validate() && document.getElementById('subject').validate() && document.getElementById('message').validate()) {
    document.getElementById('formPost').submit();
    deliverIt();
  }
}


function deliverIt() {

  $("#submit_label").css("display","none");
  $("#spinner").css("display","inline");
  
  var email = $("#email").val();
  var name = $("#name").val();
  var subject = $("#subject").val();
  var msg = $("#message").val();
  $.ajax(
  {
    type: "POST",
    url: "https://mandrillapp.com/api/1.0/messages/send.json",
    data: {
      'key': 'iRNUZYUYNNXJbqb1YhlkfA',
      'message': {
        'from_email': email,
        'from_name': name,
        'headers': {
          'Reply-To': email
        },
        'subject': subject,
        'text': msg,
        'to': [
        {
          'email': 'alejost848@gmail.com',
          'name': 'Alejandro Sanclemente',
          'type': 'to'
        }]
      }
    }
  })
  .done(function(response) {
    document.querySelector('#msgSent').show(); // show success message
    $("#name").val('');
    $("#email").val('');
    $("#subject").val('');
    $("#message").val('');

    $("#submit_label").css("display","inline");
    $("#spinner").css("display","none");
  })
  .fail(function(response) {
    document.querySelector('#msgNotSent').show(); // show fail message
    $("#submit_label").css("display","inline");
    $("#spinner").css("display","none");
  });
  return false; // prevent page refresh
}
</script>
