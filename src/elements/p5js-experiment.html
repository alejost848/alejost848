<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<script src="../../bower_components/p5.js/lib/p5.min.js"></script>

<dom-module id="p5js-experiment">
  <template>
    <style>
      :host {
        position: absolute;
        width: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
        background-color: var(--app-accent-color, transparent);
      }
    </style>

    <div id="container"></div>

  </template>

  <script>
    class P5jsExperiment extends Polymer.Element {
      static get is() { return 'p5js-experiment'; }

      ready(){
        super.ready();
        var p5_experiment = new p5(this.createSketch(), this.$.container);
      }

      createSketch(){
        var self = this;
        var p5sketch = function(sketch) {
          var horizontalCount;
          var verticalCount = 8;

          var speed = 0.5;
          var initialSpacing = 20;
          var waveSize = 0;
          var lineLength = 10;
          var spacing = 80;

          sketch.setup = function() {
            sketch.createCanvas(sketch.windowWidth, 456);
            horizontalCount = sketch.round(sketch.width / spacing);
            // HACK: Make the sketch visible in Chrome
            self.$.container.querySelector('#defaultCanvas0').style.visibility = "visible";
          };

          sketch.draw = function() {
            sketch.clear();
            sketch.strokeWeight(2);
            for (var i = 0; i <= horizontalCount; i += 1) {
              for (var j = 0; j <= verticalCount; j += 1) {
                sketch.push();

                var inter = sketch.map(i, 0, sketch.width, 0, spacing);
                var c = sketch.lerpColor(sketch.color("rgba(50, 182, 239, 0.3)"), sketch.color("rgba(50, 239, 213, 0.3)"), inter);
                sketch.stroke(c);

                var lineX = i*spacing + initialSpacing;
                var lineY = j*spacing + initialSpacing;

                var dx = sketch.mouseX - i*spacing;
                var dy = sketch.mouseY - j*spacing;
                var r = sketch.atan2(dy, dx);

                sketch.translate(i*spacing + initialSpacing, j*spacing + initialSpacing);
                // sketch.rotate(sketch.radians(sketch.frameCount * speed + i * 10 + j * 10));
                sketch.rotate(sketch.radians(sketch.frameCount * speed + i * 10 + j * 10) + r);
                sketch.translate(-i*spacing - initialSpacing, -j*spacing - initialSpacing);

                sketch.line(lineX - lineLength + waveSize, lineY, lineX + lineLength + waveSize, lineY);
                sketch.pop();
              }
            }
          };

          sketch.windowResized = function() {
            horizontalCount = sketch.round(sketch.windowWidth / spacing);
            sketch.resizeCanvas(sketch.windowWidth, sketch.height);
          };
        };

        return p5sketch;
      }
    }

    window.customElements.define(P5jsExperiment.is, P5jsExperiment);
  </script>
</dom-module>
